<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark" />
  <title>DeadLink – Documentation</title>
  <link rel="icon" href="assets/deadlink-logo.png" type="image/png" />
  
  <!-- Modern fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@800;900&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="site.css" />
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
  <div class="page">
    <nav class="topnav" aria-label="Primary">
      <div class="nav-left">
        <a class="brand backlink" href="./index.html"><img src="assets/deadlink-logo.png" alt="DeadLink logo small">DeadLink</a>
      </div>
      <div class="nav-right">
        <a href="./devops.html">DevOps</a>
        <a href="./guide.html" aria-current="page">Docs</a>
        <a href="./telemetry-report.html">Telemetry</a>
        <a href="https://github.com/thecdrz/DeadLink" target="_blank" rel="noopener">GitHub</a>
      </div>
    </nav>

    <header class="hero" style="padding-top:18px;">
      <img class="hero-logo" src="assets/deadlink-logo.png" alt="DeadLink logo">
      <p class="tagline">DOCUMENTATION</p>
    </header>

    <section class="docs-container" aria-label="Documentation">
      <aside class="docs-sidebar" aria-label="Sections">
        <div class="search" role="search">
          <label for="doc-search" class="visually-hidden">Search docs</label>
          <input id="doc-search" type="search" placeholder="Search sections…" aria-label="Search sections">
        </div>
        <ul>
          <li><a data-doc="features">Features</a></li>
          <li><a data-doc="getting-started">Getting Started</a></li>
          <li><a data-doc="installation">Installation</a></li>
          <li><a data-doc="configuration">Configuration</a></li>
          <li><a data-doc="commands">Commands</a></li>
          <li><a data-doc="analytics-and-telemetry">Analytics & Telemetry</a></li>
          <li><a data-doc="security">Security</a></li>
          <li><a data-doc="troubleshooting">Troubleshooting</a></li>
          <li><a data-doc="changelog">Changelog</a></li>
        </ul>
      </aside>
      <main class="docs-content" id="docs-content" aria-live="polite">
        <div class="loading">Loading…</div>
      </main>
    </section>

    <footer class="footerbar">
      <a class="btn" href="https://github.com/thecdrz/DeadLink" target="_blank" rel="noopener">GitHub</a>
      <a class="link" href="./index.html">Home</a>
      <a class="link" href="./devops.html">DevOps</a>
    </footer>
  </div>

  <script>
  const DEFAULT_DOC = 'getting-started';
  const routes = new Set(['features','getting-started','installation','configuration','commands','analytics-and-telemetry','security','troubleshooting','changelog']);
    const contentEl = document.getElementById('docs-content');

    function setActive(linkName){
      document.querySelectorAll('.docs-sidebar a').forEach(a => {
        const isActive = a.dataset.doc === linkName;
        a.classList.toggle('active', isActive);
        if (isActive) { a.setAttribute('aria-current', 'page'); } else { a.removeAttribute('aria-current'); }
      });
    }

    async function loadDoc(name){
      if (!routes.has(name)) name = DEFAULT_DOC;
      setActive(name);
      contentEl.innerHTML = '<div class="loading">Loading…</div>';
      try{
        if (name === 'changelog'){
          await loadChangelog();
        } else {
          const res = await fetch(`./guide/${name}.md`);
          const md = await res.text();
          const html = marked.parse(md);
          contentEl.innerHTML = html;
          contentEl.querySelectorAll('table').forEach(t => t.classList.add('doc-table'));
        }
      }catch(err){
        contentEl.innerHTML = '<p>Failed to load document.</p>';
      }
    }

    function navigate(hash){
      const name = (hash || location.hash || '').replace(/^#\/?/, '') || DEFAULT_DOC;
      loadDoc(name);
    }

    document.addEventListener('click', (e) => {
      const a = e.target.closest('.docs-sidebar a[data-doc]');
      if (!a) return;
      e.preventDefault();
      const name = a.dataset.doc;
      history.pushState({}, '', `#/${name}`);
      navigate(`#/${name}`);
    });

    window.addEventListener('popstate', () => navigate());
    navigate();

    // Simple client-side filter for sidebar items
    const searchInput = document.getElementById('doc-search');
    if (searchInput){
      searchInput.addEventListener('input', () => {
        const q = searchInput.value.trim().toLowerCase();
        document.querySelectorAll('.docs-sidebar li').forEach(li => {
          const a = li.querySelector('a');
          const text = (a?.textContent || '').toLowerCase();
          li.style.display = !q || text.includes(q) ? '' : 'none';
        });
      });
    }

  async function loadChangelog(){
      // Try to resolve the latest release notes from the repository using known filenames
      // Primary: use version.json to pick the file; Fallback: show links to release note files present in repo site.
      try{
    // Attempt to pull version.json (from GitHub raw) to decide which release notes to show
  // Use `main` as primary branch and fall back to common alternatives (master, gh-pages)
  const versionRes = await fetch('https://raw.githubusercontent.com/thecdrz/DeadLink/main/version.json', { cache: 'no-store' });
        const versionData = versionRes.ok ? await versionRes.json() : null;
        const v = versionData?.lastAnnouncedVersion;
        const fileName = v ? `RELEASE_NOTES_v${v}.md` : null;
        contentEl.innerHTML = '<div class="loading">Loading changelog…</div>';

        // Prefer GitHub raw to avoid relative path issues on Pages subpath
        const tryUrls = [];
        if (fileName){
          tryUrls.push(`https://raw.githubusercontent.com/thecdrz/DeadLink/main/${fileName}`);
          tryUrls.push(`https://raw.githubusercontent.com/thecdrz/DeadLink/master/${fileName}`);
        }
        // Fallback: two known release notes and gh-pages raw path
        tryUrls.push('https://raw.githubusercontent.com/thecdrz/DeadLink/main/RELEASE_NOTES_v2.12.1.md');
        tryUrls.push('https://raw.githubusercontent.com/thecdrz/DeadLink/main/RELEASE_NOTES_v2.12.0.md');
        tryUrls.push('https://thecdrz.github.io/DeadLink/RELEASE_NOTES_v2.12.1.md');

        let md = null;
        for (const url of tryUrls){
          try{
            const r = await fetch(url, { cache: 'no-store' });
            if (r.ok){ md = await r.text(); break; }
          }catch(_){}
        }
        if (!md){
          // Local fallback page inside docs
          try{
            const local = await fetch('./guide/changelog.md');
            if (local.ok){ md = await local.text(); }
          }catch(_){ /* ignore */ }
          if (!md){
            contentEl.innerHTML = '<p>Could not load latest release notes. See <a href="https://github.com/thecdrz/DeadLink/releases" target="_blank" rel="noopener">GitHub Releases</a>.</p>';
            return;
          }
        }
        const html = marked.parse(md);
        contentEl.innerHTML = `<article class="doc-changelog">${html}</article>`;
      }catch(err){
        contentEl.innerHTML = '<p>Failed to load changelog. See <a href="https://github.com/thecdrz/DeadLink/releases" target="_blank" rel="noopener">GitHub Releases</a>.</p>';
      }
    }
  </script>
</body>
</html>
